---
import AngularIcon from "@/icons/skills/AngularIcon.astro";
import AstroIcon from "@/icons/skills/AstroIcon.astro";
import CsharpIcon from "@/icons/skills/CsharpIcon.astro";
import CssIcon from "@/icons/skills/CssIcon.astro";
import DockerIcon from "@/icons/skills/DockerIcon.astro";
import HtmlIcon from "@/icons/skills/HtmlIcon.astro";
import JavaIcon from "@/icons/skills/JavaIcon.astro";
import JsIcon from "@/icons/skills/JsIcon.astro";
import MysqlIcon from "@/icons/skills/MysqlIcon.astro";
import NextjsIcon from "@/icons/skills/NextjsIcon.astro";
import NodeIcon from "@/icons/skills/NodeIcon.astro";
import PhpIcon from "@/icons/skills/PhpIcon.astro";
import PostgreSQLIcon from "@/icons/skills/PostgreSQLIcon.astro";
import PythonIcon from "@/icons/skills/PythonIcon.astro";
import ReactIcon from "@/icons/skills/ReactIcon.astro";
import SqlServerIcon from "@/icons/skills/SqlServerIcon.astro";
import TailwindIcon from "@/icons/skills/TailwindIcon.astro";
import TypeScriptIcon from "@/icons/skills/TypeScriptIcon.astro";

interface TechIcon {
  component: any;
  name: string;
}

const techStack: TechIcon[] = [
  { component: AngularIcon, name: "angular" },
  { component: AstroIcon, name: "astro" },
  { component: CsharpIcon, name: "csharp" },
  { component: CssIcon, name: "css" },
  { component: DockerIcon, name: "docker" },
  { component: HtmlIcon, name: "html" },
  { component: JavaIcon, name: "java" },
  { component: JsIcon, name: "javascript" },
  { component: MysqlIcon, name: "mysql" },
  { component: NextjsIcon, name: "nextjs" },
  { component: NodeIcon, name: "nodejs" },
  { component: PhpIcon, name: "php" },
  { component: PostgreSQLIcon, name: "postgresql" },
  { component: PythonIcon, name: "python" },
  { component: ReactIcon, name: "react" },
  { component: SqlServerIcon, name: "sqlserver" },
  { component: TailwindIcon, name: "tailwindcss" },
  { component: TypeScriptIcon, name: "typescript" },
];

const generateBackgroundPattern = (iconCount: number, cols: number) => {
  const pattern = [];
  let lastIndex = -1;

  for (let i = 0; i < iconCount; i++) {
    let selectedIndex;
    do {
      selectedIndex = Math.floor(Math.random() * techStack.length);
    } while (selectedIndex === lastIndex && techStack.length > 1);

    pattern.push({
      ...techStack[selectedIndex],
      position: {
        row: Math.floor(i / cols),
        col: i % cols,
      },
    });
    lastIndex = selectedIndex;
  }

  return pattern;
};

const backgroundPattern = generateBackgroundPattern(120, 12);
---

<div
  id="hero-tech-background"
  class="absolute inset-x-0 top-16 bottom-0 pointer-events-none z-0 md:block hidden"
  aria-hidden="true"
>
  <div
    class="absolute inset-0 grid grid-cols-12 gap-4 p-6 opacity-40"
    style="grid-template-rows: repeat(10, minmax(0, 1fr));"
  >
    {
      backgroundPattern.map(
        ({ component: IconComponent, name, position }, index) => (
          <div
            class="hero-tech-icon flex items-center justify-center grayscale transition-all duration-300 ease-out drop-shadow-[0_0_10px_rgba(94,145,242,0.3)] p-2"
            style={{
              gridColumn: position.col + 1,
              gridRow: position.row + 1,
              animationDelay: `${index * 50}ms`,
            }}
            data-tech={name}
          >
            <IconComponent class="w-8 h-8 lg:w-12 lg:h-12 text-four/40" />
          </div>
        ),
      )
    }
  </div>
</div>

<script type="module">
  document.addEventListener("DOMContentLoaded", () => {
    const icons = document.querySelectorAll(".hero-tech-icon");
    const container = document.getElementById("hero-tech-background");
    const isDesktop = window.matchMedia("(min-width: 768px)").matches;

    if (!container || !icons.length || !isDesktop) return;

    container.style.pointerEvents = "auto";

    const handleMouseMove = (event) => {
      const rect = container.getBoundingClientRect();
      const mouseX = event.clientX - rect.left;
      const mouseY = event.clientY - rect.top;

      icons.forEach((icon) => {
        const iconRect = icon.getBoundingClientRect();
        const iconX = iconRect.left + iconRect.width / 2 - rect.left;
        const iconY = iconRect.top + iconRect.height / 2 - rect.top;

        const distance = Math.sqrt(
          Math.pow(mouseX - iconX, 2) + Math.pow(mouseY - iconY, 2),
        );

        const maxDistance = 180;
        const proximity = Math.pow(Math.max(0, 1 - distance / maxDistance), 2);

        if (proximity > 0.01) {
          icon.style.opacity = (0.8 + proximity * 0.2).toString();
          icon.style.filter = `grayscale(${100 - proximity * 100}%) drop-shadow(0 0 ${40 + proximity * 40}px rgba(94, 145, 242, ${0.3 + proximity * 0.7}))`;
          icon.style.transform = `scale(${1 + proximity * 0.8})`;
          icon.style.zIndex = "10";
        } else {
          icon.style.opacity = "0.80";
          icon.style.filter =
            "grayscale(100%) drop-shadow(0 0 40px rgba(94, 145, 242, 0.3))";
          icon.style.transform = "scale(1)";
          icon.style.zIndex = "";
        }
      });
    };

    const handleMouseLeave = () => {
      icons.forEach((icon) => {
        icon.style.opacity = "0.80";
        icon.style.filter =
          "grayscale(100%) drop-shadow(0 0 40px rgba(94, 145, 242, 0.3))";
        icon.style.transform = "scale(1)";
        icon.style.zIndex = "";
      });
    };

    container.addEventListener("mousemove", handleMouseMove);
    container.addEventListener("mouseleave", handleMouseLeave);
  });
</script>

<style>
  @keyframes heroTechFloat {
    0%,
    100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-6px);
    }
  }

  .hero-tech-icon {
    animation: heroTechFloat 8s ease-in-out infinite;
  }

  .hero-tech-icon:nth-child(3n) {
    animation-delay: 2s;
    animation-duration: 10s;
  }

  .hero-tech-icon:nth-child(3n + 1) {
    animation-delay: 4s;
    animation-duration: 7s;
  }

  .hero-tech-icon:nth-child(3n + 2) {
    animation-delay: 6s;
    animation-duration: 9s;
  }
</style>
